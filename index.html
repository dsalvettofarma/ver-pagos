<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscador de Pagos</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    select, input, button { margin: 5px; padding: 5px; }
    table { margin-top: 20px; border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 4px; }
  </style>
</head>
<body>
  <h2>Buscador de Pagos</h2>

  <label>Hoja:</label>
  <select id="sheet" onchange="cargarColumnas()"></select><br>

  <label>Columna:</label>
  <select id="column"></select><br>

  <label>Valor:</label>
  <input id="value"><br>

  <button onclick="buscar()">Buscar</button>

  <table id="results"></table>

  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbxqiejSj2Y7bLLJBHf6fE_7vfotLDSukaR6evUkbFXoZwufIa1m5p3_Pc0iwpmYYJZZ/exec";

    function addScript(src) {
      const script = document.createElement("script");
      script.src = src;
      document.body.appendChild(script);
    }

    function cargarHojas() {
      window.handleSheets = function (data) {
        const sel = document.getElementById("sheet");
        sel.innerHTML = "";
        data.sheets.forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          sel.appendChild(opt);
        });
        cargarColumnas();
      };
      addScript(`${endpoint}?action=getSheets&callback=handleSheets`);
    }

    function cargarColumnas() {
      const hoja = document.getElementById("sheet").value;
      window.handleHeaders = function (data) {
        const sel = document.getElementById("column");
        sel.innerHTML = "";
        data.headers.forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          sel.appendChild(opt);
        });
      };
      addScript(`${endpoint}?action=getHeaders&sheet=${encodeURIComponent(hoja)}&callback=handleHeaders`);
    }

    function buscar() {
      const hoja = document.getElementById("sheet").value;
      const columna = document.getElementById("column").value;
      const valor = document.getElementById("value").value;

      window.handleSearch = function (data) {
        const table = document.getElementById("results");
        table.innerHTML = "";

        if (data.error) {
          table.innerHTML = `<tr><td colspan="10">${data.error}</td></tr>`;
          return;
        }

        const headerRow = document.createElement("tr");
        data.headers.forEach(h => {
          const th = document.createElement("th");
          th.textContent = h;
          headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        data.results.forEach(row => {
          const tr = document.createElement("tr");
          row.forEach(cell => {
            const td = document.createElement("td");
            td.textContent = cell;
            tr.appendChild(td);
          });
          table.appendChild(tr);
        });
      };

      addScript(`${endpoint}?action=search&sheet=${encodeURIComponent(hoja)}&column=${encodeURIComponent(columna)}&value=${encodeURIComponent(valor)}&callback=handleSearch`);
    }

    cargarHojas();
  </script>
</body>
</html>
